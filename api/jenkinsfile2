pipeline {
    agent any

    stages {
stage('postgres db & container') {
            steps {
        	sh'docker rmi -f postgres && docker stop cont-pg && docker rm cont-pg'        
		sh'docker run -d -p 5432:5432 --network mynetwork -e POSTGRES_PASSWORD=radha.123 --name cont-pg postgres'
            }
        }

stage('building Docker image-B') {
            steps {
		sh'docker rmi -f img-b && docker stop cont-backend && docker rm cont-backend'
		sh'cd api && docker build -t img-b .'
		
            }
        }

stage('building docker container-B') {
            steps {
		sh'docker run -d -p 8080:8080 --network mynetwork -e DATABASE_URL=postgresql://postgres:radha.123@cont-pg:5432/postgres --name cont-backend -e PORT=8080 -e MODE=local img-b'        
	
            }
        }
    }
}
