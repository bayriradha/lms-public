pipeline {
    agent any

    stages {
        stage('creation of Docker network') {
            steps {	
		sh'docker network disconnect -f mynetwork cont-backend cont-pg cont-frontend'
		sh'docker network rm mynetwork && docker network create -d bridge mynetwork'
            }
        }

stage('postgres db & container') {
            steps {
        	sh'docker rmi -f postgres'        
		sh'docker run -d -p 5432:5432 --network mynetwork -e POSTGRES_PASSWORD=radha.123 --name cont-pg postgres'
            }
        }

stage('building Docker image-B') {
            steps {
		sh'docker rmi -f img-b'
		sh'cd api && docker build -t img-b .'
		
            }
        }

stage('building docker container-B') {
            steps {
		sh'docker run -d -p 8080:8080 --network mynetwork -e DATABASE_URL=postgresql://postgres:radha.123@cont-pg:5432/postgres --name cont-backend -e PORT=8080 -e MODE=local img-b'        
	
            }
        }
    }
}
